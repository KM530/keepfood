智能食物保鲜管家 - 数据库表结构 (MySQL)
版本: 1.0
数据库: food_manager_db (建议)

摘要
本文档定义了“智能食物保鲜管家”APP后端服务所需的数据库表结构。设计遵循第三范式（3NF），并针对核心查询场景（如按过期时间排序）添加了索引以优化性能。

数据库关系图 (E-R Diagram)
[users] 1--* [foods]
[users] 1--* [categories]
[users] 1--* [locations]
[users] 1--* [shopping_list_items]
[users] 1--* [push_tokens]

[categories] 1--* [foods]
[locations] 1--* [foods]

1. 用户表 (users)
存储用户的基本信息和认证资料。

CREATE TABLE `users` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `nickname` VARCHAR(50) NOT NULL COMMENT '用户昵称',
  `avatar_url` VARCHAR(255) DEFAULT NULL COMMENT '用户头像图片的URL',
  `phone` VARCHAR(20) DEFAULT NULL UNIQUE COMMENT '手机号码，可用于登录',
  `email` VARCHAR(100) DEFAULT NULL UNIQUE COMMENT '电子邮箱，可用于登录',
  `password_hash` VARCHAR(255) NOT NULL COMMENT '加密后的用户密码',
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后更新时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';

2. 食物分类表 (categories)
存储系统预置和用户自定义的食物分类。

CREATE TABLE `categories` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '分类ID',
  `user_id` INT UNSIGNED DEFAULT NULL COMMENT '外键，关联到users表。NULL表示为系统预置分类',
  `name` VARCHAR(50) NOT NULL COMMENT '分类名称',
  `is_system` BOOLEAN NOT NULL DEFAULT FALSE COMMENT '是否为系统预置分类 (true: 是, false: 否)',
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后更新时间',
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_categories_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='食物分类表';

3. 存放位置表 (locations)
存储用户自定义的食物存放位置。

CREATE TABLE `locations` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '位置ID',
  `user_id` INT UNSIGNED NOT NULL COMMENT '外键，关联到users表',
  `name` VARCHAR(100) NOT NULL COMMENT '位置名称 (如: 冰箱冷藏室, 厨房储物柜)',
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_location_name` (`user_id`, `name`),
  CONSTRAINT `fk_locations_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='存放位置表';

4. 食物库存表 (foods)
核心表，存储用户录入的每一项食物信息。

CREATE TABLE `foods` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '食物ID',
  `user_id` INT UNSIGNED NOT NULL COMMENT '外键，关联到users表',
  `name` VARCHAR(100) NOT NULL COMMENT '食物名称',
  `image_url` JSON DEFAULT NULL COMMENT '食物图片的URL（JSON数组，可以有多个图片）',
  `quantity` DECIMAL(10, 2) NOT NULL COMMENT '数量',
  `unit` VARCHAR(20) NOT NULL COMMENT '数量单位 (如: 个, 瓶, g, ml)',
  `category_id` INT UNSIGNED NOT NULL COMMENT '外键，关联到categories表',
  `location_id` INT UNSIGNED DEFAULT NULL COMMENT '外键，关联到locations表',
  `production_date` DATE DEFAULT NULL COMMENT '生产日期',
  `shelf_life_value` INT DEFAULT NULL COMMENT '保质期数值 (如: 30)',
  `shelf_life_unit` ENUM('day', 'month', 'year') DEFAULT NULL COMMENT '保质期单位',
  `expiry_date` DATE NOT NULL COMMENT '过期日期，核心排序字段',
  `ingredients_text` TEXT DEFAULT NULL COMMENT 'AI识别的配料表原文',
  `harmful_ingredients_json` JSON DEFAULT NULL COMMENT '检测到的有害成分列表 (JSON数组)',
  `calories_kcal` INT DEFAULT NULL COMMENT 'AI分析的卡路里(千卡)',
  `energy_offset_info` VARCHAR(255) DEFAULT NULL COMMENT 'AI分析的热量抵消运动建议',
  `is_deleted` BOOLEAN NOT NULL DEFAULT FALSE COMMENT '软删除标记',
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后更新时间',
  PRIMARY KEY (`id`),
  INDEX `idx_expiry_date` (`expiry_date`),
  INDEX `idx_user_id` (`user_id`),
  CONSTRAINT `fk_foods_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_foods_category` FOREIGN KEY (`category_id`) REFERENCES `categories` (`id`),
  CONSTRAINT `fk_foods_location` FOREIGN KEY (`location_id`) REFERENCES `locations` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='食物库存表';

5. 购物清单表 (shopping_list_items)
存储用户的购物清单。

CREATE TABLE `shopping_list_items` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '清单项目ID',
  `user_id` INT UNSIGNED NOT NULL COMMENT '外键，关联到users表',
  `item_name` VARCHAR(100) NOT NULL COMMENT '商品名称',
  `is_checked` BOOLEAN NOT NULL DEFAULT FALSE COMMENT '是否已勾选购买 (true: 是, false: 否)',
  `created_from_food_id` INT UNSIGNED DEFAULT NULL COMMENT '外键，关联到foods表，记录该项是否由某个库存食物添加而来',
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后更新时间',
  PRIMARY KEY (`id`),
  INDEX `idx_user_checked` (`user_id`, `is_checked`),
  CONSTRAINT `fk_shopping_list_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_shopping_list_food` FOREIGN KEY (`created_from_food_id`) REFERENCES `foods` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='购物清单表';

6. 推送令牌表 (push_tokens)
存储用于发送推送通知的设备令牌。

CREATE TABLE `push_tokens` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '令牌ID',
  `user_id` INT UNSIGNED NOT NULL COMMENT '外键，关联到users表',
  `device_token` VARCHAR(255) NOT NULL UNIQUE COMMENT '从APNS或FCM获取的设备令牌',
  `device_type` ENUM('ios', 'android') NOT NULL COMMENT '设备类型',
  `is_active` BOOLEAN NOT NULL DEFAULT TRUE COMMENT '令牌是否有效',
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后更新时间',
  PRIMARY KEY (`id`),
  CONSTRAINT `fk_push_tokens_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='推送令牌表';
